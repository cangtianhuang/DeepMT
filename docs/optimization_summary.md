# DeepMT ä¼˜åŒ–å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### ä¼˜åŒ–1ï¼šé‡æ–°å®šä¹‰ç”¨æˆ·ä½¿ç”¨æ–¹å¼

#### å®ç°å†…å®¹

1. **ç”¨æˆ·å‹å¥½çš„APIå±‚** (`api/deepmt.py`)
   - `DeepMT` ç±»ä½œä¸ºä¸»å…¥å£
   - ç®€æ´çš„æ–¹æ³•æ¥å£
   - éšè—æ‰€æœ‰å†…éƒ¨å®ç°ç»†èŠ‚

2. **IRè‡ªåŠ¨è½¬æ¢å™¨** (`ir/converter.py`)
   - `from_operator_name()` - ä»ç®—å­åç§°åˆ›å»ºIR
   - `from_user_input()` - ä»ç”¨æˆ·è¾“å…¥åˆ›å»ºIR
   - è‡ªåŠ¨æ¨æ–­ç®—å­å±æ€§

#### ä½¿ç”¨æ–¹å¼å¯¹æ¯”

**ä¼˜åŒ–å‰**ï¼ˆéœ€è¦äº†è§£IRï¼‰ï¼š
```python
from ir.schema import OperatorIR
from mr_generator.operator_mr import OperatorMRGenerator
# ... éœ€è¦äº†è§£å¤šä¸ªç»„ä»¶

add_ir = OperatorIR(
    name="Add",
    inputs=[1.0, 2.0],
    outputs=[],
    properties={"commutative": True}
)
# ... å¤æ‚çš„åˆå§‹åŒ–è¿‡ç¨‹
```

**ä¼˜åŒ–å**ï¼ˆIRå®Œå…¨éšè—ï¼‰ï¼š
```python
from deepmt import DeepMT

client = DeepMT()
result = client.test_operator("Add", [1.0, 2.0], "pytorch")
print(result.summary())
```

#### ç”¨æˆ·çœ‹åˆ°çš„ç»“æœ

1. **æµ‹è¯•æ‘˜è¦**ï¼ˆæ§åˆ¶å°ï¼‰
   ```
   ============================================================
   DeepMT æµ‹è¯•ç»“æœ
   ============================================================
   åç§°: Add
   æ¡†æ¶: pytorch
   æ€»æµ‹è¯•æ•°: 3
   é€šè¿‡: 3
   å¤±è´¥: 0
   è€—æ—¶: 0.12s
   ============================================================
   ```

2. **ç»“æœæŸ¥è¯¢**
   ```python
   # æŸ¥çœ‹æµ‹è¯•å†å²
   history = client.get_test_history("Add")
   
   # æŸ¥çœ‹å¤±è´¥çš„æµ‹è¯•
   failures = client.get_failed_tests()
   ```

---

### ä¼˜åŒ–2ï¼šIRå¯¹ç”¨æˆ·éšè—

#### å®ç°å†…å®¹

1. **IRè½¬æ¢å™¨** (`ir/converter.py`)
   - è‡ªåŠ¨ä»ç”¨æˆ·è¾“å…¥åˆ›å»ºIR
   - è‡ªåŠ¨æ¨æ–­ç®—å­å±æ€§
   - ç”¨æˆ·ä¸éœ€è¦çŸ¥é“IRçš„å­˜åœ¨

2. **APIå±‚å°è£…**
   - æ‰€æœ‰IRåˆ›å»ºéƒ½åœ¨APIå†…éƒ¨å®Œæˆ
   - ç”¨æˆ·åªéœ€è¦æä¾›ç®€å•çš„è¾“å…¥

#### æ¶æ„å˜åŒ–

```
ä¼˜åŒ–å‰ï¼š
ç”¨æˆ· â†’ æ‰‹åŠ¨åˆ›å»ºIR â†’ ç³»ç»Ÿ

ä¼˜åŒ–åï¼š
ç”¨æˆ· â†’ API â†’ IRè½¬æ¢å™¨ â†’ IRï¼ˆå†…éƒ¨ï¼Œç”¨æˆ·ä¸å¯è§ï¼‰ â†’ ç³»ç»Ÿ
```

---

### ä¼˜åŒ–3ï¼šMRç”Ÿæˆä¸æµ‹è¯•åˆ†ç¦»

#### å®ç°å†…å®¹

1. **MRçŸ¥è¯†åº“** (`mr_generator/mr_repository.py`)
   - æŒä¹…åŒ–å­˜å‚¨MR
   - æ”¯æŒæŒ‰ç®—å­åç§°æŸ¥è¯¢
   - æ”¯æŒMRç‰ˆæœ¬ç®¡ç†

2. **æµ‹è¯•æ‰§è¡Œå™¨** (`core/test_runner.py`)
   - ç‹¬ç«‹çš„æµ‹è¯•æ‰§è¡Œå™¨
   - æ¥æ”¶é¢„ç”Ÿæˆçš„MR
   - ä¸è´Ÿè´£MRç”Ÿæˆ

3. **TaskSchedulerå¢å¼º**
   - æ”¯æŒä½¿ç”¨é¢„ç”Ÿæˆçš„MR
   - æ”¯æŒåŠ¨æ€ç”ŸæˆMRï¼ˆå‘åå…¼å®¹ï¼‰

#### å·¥ä½œæµç¨‹

**MRç”Ÿæˆé˜¶æ®µ**ï¼ˆç‹¬ç«‹ï¼‰ï¼š
```python
# ç”ŸæˆMRå¹¶ä¿å­˜
generator = OperatorMRGenerator()
mrs = generator.generate(operator_ir)
mr_repository.save("Add", mrs)
```

**MRæµ‹è¯•é˜¶æ®µ**ï¼ˆé‡ç”¨ï¼‰ï¼š
```python
# ä»çŸ¥è¯†åº“åŠ è½½MR
mrs = mr_repository.load("Add")

# ä½¿ç”¨é¢„ç”Ÿæˆçš„MRæµ‹è¯•
test_runner.run_with_mrs(ir, mrs, "pytorch")
```

#### ä¼˜åŠ¿

1. **MRé‡ç”¨**ï¼šåŒä¸€ä¸ªMRå¯ä»¥æµ‹è¯•å¤šä¸ªæ¡†æ¶
2. **æ€§èƒ½æå‡**ï¼šé¿å…é‡å¤ç”ŸæˆMR
3. **çŸ¥è¯†ç§¯ç´¯**ï¼šMRä½œä¸ºçŸ¥è¯†ä¿å­˜ä¸‹æ¥
4. **çµæ´»æ€§**ï¼šå¯ä»¥ç‹¬ç«‹ç”Ÿæˆå’Œæµ‹è¯•MR

---

## ğŸ“Š æ¶æ„å¯¹æ¯”

### ä¼˜åŒ–å‰æ¶æ„
```
ç”¨æˆ·
  â†“
æ‰‹åŠ¨åˆ›å»ºIR
  â†“
MRGeneratorï¼ˆç”ŸæˆMRï¼‰
  â†“
TaskSchedulerï¼ˆç”ŸæˆMR + æ‰§è¡Œæµ‹è¯•ï¼‰
  â†“
ç»“æœ
```

### ä¼˜åŒ–åæ¶æ„
```
ç”¨æˆ·
  â†“
DeepMT APIï¼ˆIRè‡ªåŠ¨åˆ›å»ºï¼Œéšè—ï¼‰
  â†“
IRè½¬æ¢å™¨ â†’ IRï¼ˆå†…éƒ¨ï¼‰
  â†“
MRçŸ¥è¯†åº“ â† MRGeneratorï¼ˆç‹¬ç«‹ç”Ÿæˆï¼‰
  â†“
TestRunnerï¼ˆä½¿ç”¨é¢„ç”ŸæˆMRæ‰§è¡Œæµ‹è¯•ï¼‰
  â†“
ç»“æœ â†’ æŠ¥å‘Š
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæœ€ç®€å•çš„ä½¿ç”¨
```python
from deepmt import DeepMT

client = DeepMT()
result = client.test_operator("Add", [1.0, 2.0], "pytorch")
print(result.summary())
```

### ç¤ºä¾‹2ï¼šæ‰¹é‡æµ‹è¯•
```python
operators = [
    {"name": "Add", "inputs": [1.0, 2.0]},
    {"name": "Multiply", "inputs": [3.0, 4.0]},
]

results = client.test_operators(operators, "pytorch")
```

### ç¤ºä¾‹3ï¼šMRç”Ÿæˆä¸æµ‹è¯•åˆ†ç¦»
```python
# ç”ŸæˆMR
generator = OperatorMRGenerator()
mrs = generator.generate(operator_ir)
mr_repository.save("Add", mrs)

# åç»­æµ‹è¯•é‡ç”¨MR
mrs = mr_repository.load("Add")
test_runner.run_with_mrs(ir, mrs, "pytorch")
```

### ç¤ºä¾‹4ï¼šé…ç½®æ–‡ä»¶
```yaml
# config.yaml
tests:
  - type: operator
    name: Add
    inputs: [1.0, 2.0]
    framework: pytorch
```

```python
results = client.test_from_config("config.yaml")
```

---

## ğŸ“ æ–°å¢æ–‡ä»¶

1. `api/deepmt.py` - ç”¨æˆ·å‹å¥½çš„API
2. `api/__init__.py` - APIåŒ…åˆå§‹åŒ–
3. `ir/converter.py` - IRè‡ªåŠ¨è½¬æ¢å™¨
4. `mr_generator/mr_repository.py` - MRçŸ¥è¯†åº“
5. `core/test_runner.py` - æµ‹è¯•æ‰§è¡Œå™¨
6. `examples/user_friendly_example.py` - ä½¿ç”¨ç¤ºä¾‹

---

## ğŸ”„ ä¿®æ”¹çš„æ–‡ä»¶

1. `core/scheduler.py` - æ”¯æŒé¢„ç”ŸæˆMR
2. `api/deepmt.py` - é›†æˆMRçŸ¥è¯†åº“

---

## âœ… ä¼˜åŒ–æˆæœ

1. **ç”¨æˆ·å‹å¥½æ€§** â¬†ï¸
   - ä»éœ€è¦äº†è§£IR â†’ 3è¡Œä»£ç å®Œæˆæµ‹è¯•
   - ä»æ‰‹åŠ¨åˆ›å»ºIR â†’ è‡ªåŠ¨è½¬æ¢

2. **æ¶æ„æ¸…æ™°æ€§** â¬†ï¸
   - MRç”Ÿæˆä¸æµ‹è¯•åˆ†ç¦»
   - IRä½œä¸ºå†…éƒ¨è¡¨ç¤ºï¼Œç”¨æˆ·ä¸å¯è§

3. **å¯æ‰©å±•æ€§** â¬†ï¸
   - MRå¯ä»¥æŒä¹…åŒ–å’Œé‡ç”¨
   - æ”¯æŒMRçŸ¥è¯†åº“ç®¡ç†

4. **æ€§èƒ½** â¬†ï¸
   - MRå¯ä»¥é‡ç”¨ï¼Œé¿å…é‡å¤ç”Ÿæˆ
   - æ”¯æŒæ‰¹é‡æµ‹è¯•

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å‘½ä»¤è¡Œå·¥å…·** (`cli/`)
   - å®ç° `deepmt` å‘½ä»¤
   - æ”¯æŒé…ç½®æ–‡ä»¶

2. **æŠ¥å‘Šç”Ÿæˆä¼˜åŒ–**
   - HTMLæŠ¥å‘Šæ¨¡æ¿
   - å¯è§†åŒ–å›¾è¡¨

3. **MRçŸ¥è¯†åº“å¢å¼º**
   - MRæœ‰æ•ˆæ€§éªŒè¯
   - MRç‰ˆæœ¬ç®¡ç†
   - MRæœç´¢å’ŒæŸ¥è¯¢

---

## ğŸ“ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼ŒDeepMTé¡¹ç›®ï¼š

1. âœ… **å¯¹ç”¨æˆ·æ›´å‹å¥½**ï¼šIRå®Œå…¨éšè—ï¼ŒAPIç®€æ´
2. âœ… **æ¶æ„æ›´æ¸…æ™°**ï¼šMRç”Ÿæˆä¸æµ‹è¯•åˆ†ç¦»
3. âœ… **åŠŸèƒ½æ›´å¼ºå¤§**ï¼šMRå¯ä»¥æŒä¹…åŒ–å’Œé‡ç”¨
4. âœ… **ä½¿ç”¨æ›´ç®€å•**ï¼š3è¡Œä»£ç å®Œæˆæµ‹è¯•

ç”¨æˆ·ç°åœ¨å¯ä»¥ä¸“æ³¨äºæµ‹è¯•æœ¬èº«ï¼Œè€Œä¸éœ€è¦äº†è§£å†…éƒ¨å®ç°ç»†èŠ‚ã€‚

